---
author: 小风果果
date: 2018-04-09 23:42:32+00:00
layout: post
title: 搭建ShowDoc文档工具
subtitle: 搭建ShowDoc文档工具
catalog: true
tags:
- showdoc
- api
---

# 搭建ShowDoc文档工具

## ShowDoc是什么

每当接手一个他人开发好的模块或者项目，看着那些没有写注释的代码，我们都无比抓狂。文档呢？！文档呢？！**Show me the doc ！！**

程序员都很希望别人能写技术文档，而自己却很不希望要写文档。因为写文档需要花大量的时间去处理格式排版，想着新建的word文档放在哪个目录等各种非技术细节。

word文档零零散散地放在团队不同人那里，需要文档的人基本靠吼，吼一声然后上qq或者邮箱接收对方丢过来的文档。这种沟通方式当然可以，只是效率不高。 

ShowDoc就是一个非常适合IT团队的在线文档分享工具，它可以加快团队之间沟通的效率。
### 项目地址
https://github.com/star7th/showdoc

## 准备Nginx+PHP环境

### 安装nginx

使用 `yum` 安装 Nginx：

```
yum install nginx
```

修改 [/etc/nginx/nginx.conf]() 文件为如下内容：

```
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
}

http {
    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;
    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80;
        server_name  127.0.0.1;
        root         /var/www/html;
        index index.php index.html
        error_page  404              /404.html;
        location = /40x.html {
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
        }
        location ~ .php$ {
            root           /var/www/html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include        fastcgi_params;
        }
        location ~ /.ht {
            deny  all;
        }
    }
}
```

启动 Nginx 并设置为开机启动：

```
service nginx start
chkconfig nginx on
```

### 安装 PHP

使用 `yum` 安装 php-fpm：

```
yum install php php-gd php-fpm php-mcrypt php-mbstring php-mysql php-pdo
```

启动 php-fpm 并设置为开机启动：

```
service php-fpm start
chkconfig php-fpm on
```

## 创建项目

下载安装 Composer

Composer 是 PHP 的一个依赖管理工具，功能上类似于Java 的 Maven，Python 的 pip，Ruby的 gem，Nodejs 的 npm。通过Composer，你可以通过几句命令行便可以下载安装好ShowDoc，推荐使用 Composer 创建 ShowDoc 项目。执行如下命令安装 Composer：

```
curl -sS https://getcomposer.org/installer | php
mv composer.phar /usr/local/bin/composer
```

设置 Composer 使用国内镜像

执行命令设置 Composer 使用国内镜像：

```
composer config -g repo.packagist composer https://packagist.phpcomposer.com
```

使用 Composer 创建项目

执行命令创建项目：

```
cd /var/www/html/ && composer create-project  showdoc/showdoc
```

设置 showdoc 目录写权限

执行命令赋予 showdoc 下部分目录的写权限

```
chmod a+w showdoc/install
chmod a+w showdoc/Sqlite
chmod a+w showdoc/Sqlite/showdoc.db.php
chmod a+w showdoc/Public/Uploads/
chmod a+w showdoc/Application/Runtime
chmod a+w showdoc/server/Application/Runtime
chmod a+w showdoc/Application/Common/Conf/config.php
chmod a+w showdoc/Application/Home/Conf/config.php
```

创建完毕，您现在可以通过浏览器访问 <http://ip/showdoc/install/> ，进行语言的选择以后即可通过 <http://ip/showdoc> 查看站点效果。

### 准备域名和解析

域名注册

域名解析

### 使用在线的ShowDoc

- 如果你没有自己的服务器，但又想使用ShowDoc作为分档分享工具，你可以使用在线的ShowDoc [http://www.showdoc.cc](http://www.showdoc.cc/home/user/login)

## 数据字典

好的数据字典文档能够清晰地反映出数据库的结构以及相关释义，方便技术人员查阅。我们很容易使用showdoc来生成展示数据库结构的字典文档，并且能根据数据库结构的变动来自动修改文档，省去人工编辑的麻烦。

这一切的自动化依赖于我们的上报脚本。你需要下载我们的脚本到你的服务器上执行，上传数据库结构信息到showdoc。上报脚本的源码完全公开，你可以阅读之以确认安全。我们确保它只会上传基本数据库结构信息，不会上传数据库密码配置、业务数据等敏感信息。

目前只支持linux下的mysql数据库，更多类型未来再考虑。

操作步骤

执行下载脚本的命令
````
wget https://www.showdoc.cc/script/showdoc_db.sh 
````
打开此文件
````
vi showdoc_db.sh
````
修改配置信息
打开文件后，在文件的前面能看到几项配置。其中，像数据库配置、api_key等信息是需要你填写的，填写完毕后保存即可。下面列举出各个配置项代表的意思。

````
host ： 数据库所在地址。默认是localhost  
port  :  数据库访问端口，默认是3306 
user  :  数据库用户名 
password   :  密码 
db  :  要同步的数据库名。要同步多个db可以将本脚本复制多份 |
api_key   ： 认证凭证。登录showdoc，创建一个项目后，点击右上角的”项目设置”-“开放API”便可看到 
api_token : 同上  
cat_name: 可选。如果想把生成的文档都放在项目的子目录下，则这里填写子目录名。  
url ： 可选。同步到的url。如果是使用www.showdoc.cc ，则不需要再改此项。如果是部署开源版showdoc，请改此项为http://xx.com/server/index.php?s=/api/open/updateDbItem 。其中xx.com为你的部署域名|
````
执行
````
sh showdoc_db.sh 
````
看到成功字样便ok。你可以打开showdoc项目看看是否真的生成了。

如果想定时自动更新，则需要为系统增加一个定时任务。下面给一个例子，表示每10分钟同步一次
````
/10 * * * * /bin/sh /root/showdoc_db.sh
````
其中，showdoc_db.sh脚本在定时任务里需要写绝对路径。

注意事项

如果你设置了脚本的自动执行，那么请不要再手动登录showdoc修改文档。因为你的修改都会被自动脚本重新覆盖。
因为会覆盖你的修改。所以如果你想为某个字段设置中文注释，请修改mysql字段注释，而不是在showdoc上手动编辑文档。
自动执行的情况下，只会自动新增和修改文档，不会自动删除文档（主要出于数据安全考虑）。所以，如果你删除了一张表，文档里是不会删除那个页面的。需要手动登录showdoc来删除。一般来讲，这种情况不会很多。